<!-- 12.4.1 -->
## Поиск и устранение неполадок на физическом уровне

Теперь, когда вы собрали документацию, знаете методы устранения неполадок и программные и аппаратные средства для диагностики, можно начать поиск и устранение неисправностей. В этом разделе рассматриваются наиболее распространенные проблемы при устранении неполадок в сети.

Во многих случаях проблемы в сети отражаются на производительности. Это значит, что ожидаемый и реальный режим работы отличаются, и система не функционирует должным образом. Отказы и неоптимальные состояния на физическом уровне не только создают неудобства пользователям, но и могут отрицательно влиять на производительности всей компании. Сети, где возникают подобные ситуации, обычно перестают работать. Так как верхние уровни модели OSI зависят от физического уровня, у администратора должна быть возможность эффективно изолировать и устранять такие проблемы.

На рисунке обобщены симптомы и причины проблем с сетью физического уровня.

![](./assets/12.4.1.svg)
<!-- /courses/ensa-dl/ae8eb396-34fd-11eb-ba19-f1886492e0e4/aeb65fd0-34fd-11eb-ba19-f1886492e0e4/assets/c6f53ab0-1c46-11ea-af56-e368b99e9723.svg -->

<!--
На рисунке обобщены симптомы и причины проблем с сетью физического уровня. На рисунке показана 7-уровневая модель OSI с симптомами и причинами на физическом уровне. Симптомы: производительность ниже базового уровня, потеря подключения, узкие места или перегрузка сети, высокая загрузка ЦП и сообщения об ошибках консоли. Причины: питание, неисправности оборудования, кабелей, затухание, шум, ошибки конфигурации интерфейса, превышение проектных ограничений и перегрузка ЦП. 
-->

В таблице перечислены распространенные симптомы проблем с сетью физического уровня.

| **Признак** | **Описание** |
| --- | --- |
| **Уровень производительности ниже базового**  | <ul><li>Нужны предыдущие исходные условия для сравнения.</li><li>Самые распространенные причины медленного или плохого функционирования — перегрузка или недостаточная вычислительная мощность серверов, ненадлежащая настройка коммутаторов или маршрутизаторов, затор трафика в канале с низкой пропускной способностью и постоянная потеря кадров.</li></ul> |
| **Потеря связи**  | <ul><li>Потеря связи может быть вызвана неисправностью или отсоединением кабеля. Самый очевидный симптом — потеря связи между устройствами, которые обмениваются данными по каналу с неисправным устройством либо интерфейсом.</li><li>Такую ситуацию можно обнаружить с помощью обычного ping-запроса (ping). </li><li>Неустойчивая связь может указывать на плохой электрический контакт или окислившиеся контактные поверхности.</li></ul> |
| **Ограниченная пропускная способность или перегрузка сети**  | <ul><li>Если роутер, интерфейс или кабель выходит из строя, протоколы могут перенаправить трафик на другие маршруты, которые не рассчитаны на обработку дополнительного трафика. Это приводит к заторам или появлению</li><li>«узких мест» в таких зонах.</li></ul> |
| **Высокая интенсивность использования ЦП**  | <ul><li>Высокая интенсивность использования ЦП говорит о том, что устройство (маршрутизатор, коммутатор или сервер) работает на пределе своей расчетной производительности или превышает его.</li><li>Если проблему быстро не устранить, то перегрузка ЦП может привести к выключению или отказу устройства.</li></ul> |
| **Консольные сообщения об ошибках**  | <ul><li>Сообщения об ошибках, выводимые на консоли устройства, указывают на проблему на физическом уровне.</li><li>Сообщения консоли должны регистрироваться на центральном сервере системного журнала.</li></ul> |

К общим сетевым проблемам на физическом уровне относятся следующие:

| **Причина проблемы** | **Описание** |
| --- | --- |
| **Проблемы с электропитанием**  | <ul><li>Это основная причина сбоя сети. </li><li>Необходимо проверить режим работы вентиляторов и убедиться, что впускные и вытяжные вентиляционные каналы корпуса не загрязнены. </li><li>Если на другие расположенные поблизости устройства также не поступает электропитание, предположительно неисправен основной источник питания.</li></ul> |
| **Отказы оборудования**  | <ul><li>Неисправные платы сетевых интерфейсов (NIC) могут быть причиной ошибок при передаче данных вследствие коллизий, коротких кадров и некорректных сигналов.</li><li> Некорректный сигнал (Jabber) часто определяется как состояние, при котором устройство непрерывно передает беспорядочные и бессмысленные данные в сеть.</li><li>Другие вероятные причины таких сигналов — поврежденные файлы драйверов сетевых карт, плохие кабельные соединения или проблемы с заземлением.</li></ul> |
| **Проблемы с кабелями**  | <ul><li>Многие проблемы можно устранить путем повторного подключения кабелей, которые частично отсоединились.</li><li>Во время физического контроля обращайте внимание на поврежденные кабели, их неправильные типы и дефектные разъемы RJ-45.</li><li>Предположительно неисправные кабели следует проверить и заменить исправными.</li></ul> |
| **Затухание**  | <ul><li>Затухание может происходить, если длина кабеля превышает расчетный предел для среды передачи данных или при подключении некачественным кабелем, либо загрязнении или окислении контактов.</li><li> Если уровень ослабления высокий, принимающее устройство не всегда сможет успешно отличать друг от друга битовые компоненты в потоке данных.</li></ul> |
| **Шум**  | <ul><li>Обычно шумом называют локальные электромагнитные помехи (EMI).</li><li>Шум могут создавать разные источники: радиостанции, полицейские системы радиосвязи, системы обеспечения безопасности в зданиях, авиационные системы для автоматической посадки, перекрестные помехи (от других кабелей в том же канале, или от соседних кабелей), расположенные поблизости электрические кабели, устройства с крупными электродвигателями или любое оборудование, содержащее радиопередатчик мощнее мобильного телефона.</li></ul> |
| **Ошибки в настройке интерфейса**  | <ul><li>На интерфейсе многие параметры могут быть неправильно настроенными, что может привести к неработоспособности интерфейса, например неправильная тактовая частота, неправильный источник синхронизации, а также состояние, когда интерфейс не включен.</li><li>Это приводит к потере связи с подключенными сегментами сети.</li></ul> |
| **Превышение расчетных предельных значений**  | <ul><li>Компонент может работать некорректно на физическом уровне, если он используется с нарушением технических спецификаций или возможностей конфигурации.</li><li>При устранении проблем такого типа становится очевидно, что ресурсы для устройства работают на максимальном или почти максимальном уровне, что увеличивает количество ошибок интерфейса.</li></ul> |
| **Перегрузка ЦП**  | <ul><li>К симптомам относятся процессы с высоким процентом загрузки ЦП, снижение количества входных очередей, низкая производительность, истечение времени ожидания SNMP, отсутствие удаленного доступа, медленная работа или отсутствие ответа сервисов, таких как DHCP, Telnet и ping.</li><li>На коммутаторе может произойти следующее: повторная сходимость протокола связующего дерева, скачкообразная работа каналов EtherChannel, нестабильность UDLD, сбои IP SLA.</li><li>Роутеры могут столкнуться с отсутствием обновлений маршрутизации, нестабильностью маршрутов или нестабильностью HSRP.</li><li>Одной из причин перегрузки ЦП на роутере или коммутаторе может быть интенсивный трафик.</li><li>Если один или несколько интерфейсов постоянно оказываются в состоянии перегрузки по трафику, рекомендуется перераспределить потоки трафика в сети или модернизировать аппаратное обеспечение.</li></ul> |

<!-- 12.4.2 -->
## Поиск и устранение неполадок канального уровня

Процесс поиска и устранения неполадок на уровне 2 может быть сложным. Настройка и функционирование этих протоколов крайне важны для создания функциональной, хорошо настроенной сети. Отличительные признаки проблем на уровне 2 в случае их обнаружения позволят оперативно выявить неисправность.

На рисунке обобщены симптомы и причины проблем сети на уровне канала данных.

![](./assets/12.4.2.svg)
<!-- /courses/ensa-dl/ae8eb396-34fd-11eb-ba19-f1886492e0e4/aeb65fd0-34fd-11eb-ba19-f1886492e0e4/assets/c6f62511-1c46-11ea-af56-e368b99e9723.svg -->

<!--
На рисунке обобщены симптомы и причины проблем на уровне канала данных. На рисунке показана 7-уровневая модель OSI с симптомами и причинами на канальном уровне. Симптомы: Неработоспособность или отсутствие связи на сетевом уровне или выше расположенных уровнях, Фактический уровень производительности сети ниже базового, Чрезмерный широковещательный трафик, Консольные сообщения. Причинами являются ошибки инкапсуляции, ошибки сопоставления адресов, ошибки формирования кадров и сбои STP или коммутационные петли.
-->

В таблице перечислены распространенные симптомы сетевых проблем на  канальном уровне.

| **Признак** | **Описание** |
| --- | --- |
| **Потеря подключения или работоспособности на сетевом уровне и выше** | Некоторые проблемы уровня 2 могут остановить обмен кадрами по каналу передачи данных, в то время как другие приводят к ухудшению производительности сети. |
| **Сеть не достигает базового показателя производительности**  | <ul><li>В сети могут возникнуть два типа не оптимальных операций уровня 2 </li><li>Во-первых, передача кадров по неоптимальному пути к месту назначения приводит к неожиданно высокому потреблению пропускной способности каналов передачи данных. </li><li>Во-вторых, некоторые кадры отбрасываются, как определенные через статистику учета ошибок и через консольные сообщения на коммутаторе или роутере. </li><li>Расширенный или непрерывный ping может помочь определить, начинают ли кадры отбрасываться.</li></ul> |
| **Чрезмерный объем широковещательного трафика**  | <ul><li>Операционные системы широко используют широковещательные и многоадресные передачи для обнаружения сетевых служб и других узлов. </li><li>Как правило, чрезмерный широковещательный трафик возникает в следующих ситуациях: плохо разработанные или настроенные приложения, крупные домены на уровне 2 для широковещательной рассылки или базовые сетевые проблемы, например петли STP или нестабильность маршрутов.</li></ul> |
| **Консольные сообщения**  | <ul><li>В некоторых случаях роутер обнаруживает неполадки на уровне 2 и посылает предупреждающие сообщения на консоль. </li><li>Как правило, это происходит при интерпретации входящих кадров (проблемы с инкапсуляцией или формированием кадров) или при отсутствии сообщений keepalive, которые должны поступать. </li><li>Самое распространенное сообщение об ошибке на консоли — отключение протокола, свидетельствующее о проблеме на 2-м уровне сети.</li></ul> |

В таблице перечислены причины проблем с сетью на канальном уровне.

| **Причина проблемы** | **Описание** |
| --- | --- |
| **Ошибки инкапсуляции** | <ul><li>Ошибка инкапсуляции происходит, если помещаемые в конкретное поле биты отличаются от ожидаемых получателем. </li><li>Это возникает, если настройки инкапсуляции на обоих концах канала WAN отличаются.</li></ul> |
| **Ошибки сопоставления адресов** | <ul><li>В таких топологиях, как «точка — несколько точек», Frame Relay или широковещательный Ethernet, необходимо, чтобы кадр содержал соответствующий адрес назначения на уровне 2. Это обеспечит верное прибытие. </li><li>Сетевое устройство должно сопоставлять адрес назначения на уровне 3 с правильным адресом на уровне 2 с помощью статических или динамических сопоставлений. </li><li>В динамической среде при сопоставлении информации на уровнях 2 и 3 могут происходить ошибки, так как на устройствах может быть настроен запрет отвечать на запросы ARP, а сохраненная в кэше информация на уровне 2 или 3 могла быть физически изменена либо были получены недействительные отклики ARP из-за неправильной настройки или атак.</li></ul> |
| **Ошибки формирования кадров** | <ul><li>Обычно кадры формируются в виде групп из 8-битовых байтов </li><li>Ошибка формирования кадров возникает, если кадр не заканчивается на границе 8-битового байта. </li><li>В этом случае у получателя могут возникнуть проблемы при определении окончания одного кадра и начала другого. </li><li>Слишком большое количество неправильных кадров может приводить к невозможности обмена сообщениями keepalive. </li><li>Ошибки формирования кадров могут быть вызваны высоким уровнем помех на последовательной линии, неправильно спроектированным кабелем (слишком длинным или неправильно экранированным), неисправной сетевой интерфейсной платой, несоответствием дуплексных режимов или некорректно настроенными тактовыми сигналами на устройствах обслуживания канала.</li></ul> |
| **Сбои или петли STP** | <ul><li>Протокол STP предназначен для преобразования физической топологии с резервными путями в древовидную топологию путем блокировки резервных портов. </li><li>Большинство проблем STP связаны с петлями передачи данных, которые возникают, если в топологии с резервными путями не заблокированы порты, после чего трафик циклично перенаправляется. Также причины часто могут быть в чрезмерной лавинной рассылкой из-за очень частого изменения топологии STP. </li><li>В хорошо настроенной сети перестроение топологии случается крайне редко. </li><li>Если канал между двумя коммутаторами начинает или перестает работать, топология изменяется (меняется состояние порта в STP, так как порт начинает или перестает участвовать в передаче данных). </li><li>Однако если порт работает неустойчиво (быстрое чередование состояний up и down), это вызовет частые изменения топологии и лавинную рассылку либо медленную сходимость или повторное схождение STP. </li><li>Такая ситуация может быть вызвана несоответствием между реальной и задокументированной топологией, ошибкой настройки, например противоречивой настройкой таймеров STP, перегрузкой ЦП коммутатора во время схождения или ошибкой в программном обеспечении.</li></ul> |

<!-- 12.4.3 -->
## Поиск и устранение неполадок сетевого уровня

На сетевом уровне проблемы связаны с протоколом 3 уровня: IPv4, IPv6, EIGRP, OSPF и т.д. На рисунке обобщены симптомы и причины.

![](./assets/12.4.3.svg)
<!-- /courses/ensa-dl/ae8eb396-34fd-11eb-ba19-f1886492e0e4/aeb65fd0-34fd-11eb-ba19-f1886492e0e4/assets/c6f784a2-1c46-11ea-af56-e368b99e9723.svg -->

<!--
На рисунке показана 7-уровневая модель OSI с симптомами и причинами на сетевом уровне. Симптомы: сбой сети и неоптимальная производительность. Причины: общие проблемы с сетью, проблемы с подключением, таблица маршрутизации, проблемы с соседями и база данных топологии.
-->

В таблице перечислены распространенные симптомы проблем на сетевом уровне.

| **Признак** | **Описание** |
| --- | --- |
| **Сбой в сети**  | <ul><li>Сбой происходит, когда сеть полностью или частично неработоспособна, что сказывается на всех пользователях и приложениях. </li><li>Обычно о таких сбоях быстро сообщают пользователи и администраторы из-за упавшей производительности.</li></ul> |
| **Недостаточная производительность**  | <ul><li>Проблемы оптимизации сети обычно распространяются на группу пользователей, приложений, пунктов назначения или на конкретный тип трафика. </li><li>Проблемы оптимизации трудно обнаружить, изолировать и диагностировать. </li><li>Это связано с тем, что обычно они затрагивают несколько уровней или даже сам хост целиком. </li><li>Чтобы определить, относится ли проблема к сетевому уровню, может потребоваться время.</li></ul> |

Во многих сетях статические маршруты используются вместе с динамическими протоколами маршрутизации. Неправильная настройка может привести к неоптимальной маршрутизаци и появлению петель, делающих невозможной связь с отдельными частями сети.

При отладке таких протоколов требуется высокий уровень знаний о их функционировании. Одни проблемы общие для всех, а другие относятся только к конкретным протоколам маршрутизации.

Не существует одного варианта решения всех неполадок, которые могут возникать на уровне 3. Для устранения проблем маршрутизации следует применять методичный подход с помощью набора команд для изоляции и диагностики.

В таблице перечислены области, которые необходимо изучить при диагностировании возможной проблемы, связанной с протоколами маршрутизации.

| **Причина проблемы** | **Описание** |
| --- | --- |
| **Общие сетевые проблемы**  | <ul><li>Во многих случаях изменение топологии, например выход канала из строя, может оказывать влияние на другие зоны сети, что может быть неочевидным в некоторый момент времени. </li><li>Это влечет за собой установку или удаление маршрутов (статических и динамических). </li><li>Выясните, вносились ли изменения в сети и работает ли кто-то над ее инфраструктурой.</li></ul> |
| **Проблемы со связью**  | <ul><li>Проверьте наличие любых проблем с оборудованием и связью, включая электропитание, например, отключения и проблемы окружающей среды (такие как перегрев). </li><li>Также проверьте наличие проблем на уровне 1, например, некачественные кабельные соединения, неисправные порты, а также проблемы на стороне интернет-провайдера.</li></ul> |
| **Таблица маршрутизации**  | <ul><li>Проверьте, нет ли в таблице чего-то необычного, например, отсутствующих или неожиданных маршрутов. </li><li>Используйте команду **debug** для просмотра обновлений маршрутизации и сопровождения таблицы.</li></ul> |
| **Проблемы соседних устройств**  | Если протокол маршрутизации формирует отношения смежности с соседним роутером, проверьте наличие проблем между ними. |
| **База данных топологии**  | Если протокол маршрутизации использует таблицу или базу данных топологии, проверьте, нет ли в ней чего-то необычного, например отсутствующих или неожиданных записей. |

<!-- 12.4.4 -->
## Поиск и устранение неполадок на транспортном уровне — списки контроля доступа

Сетевые проблемы могут возникать на транспортном уровне маршрутизатора, особенно на границе, где выполняется анализ и изменение трафика. Например, списки управления доступом (ACL) и преобразование сетевых адресов (NAT) работают на сетевом и могут включать операции на транспортном уровне, как показано на рисунке.

![](./assets/12.4.4-1.svg)
<!-- /courses/ensa-dl/ae8eb396-34fd-11eb-ba19-f1886492e0e4/aeb65fd0-34fd-11eb-ba19-f1886492e0e4/assets/c6f89610-1c46-11ea-af56-e368b99e9723.svg -->

<!--
На рисунке показана 7-уровневая модель OSI с симптомами и причинами на транспортном уровне. Симптомы: проблемы с подключением и проблемы доступа. Причины: конфигурации ACL и NAT.
-->

В большинстве случаев проблемы с ACL возникают из-за неправильной настройки, как показано на рисунке.

![](./assets/12.4.4-2.svg)
<!-- /courses/ensa-dl/ae8eb396-34fd-11eb-ba19-f1886492e0e4/aeb65fd0-34fd-11eb-ba19-f1886492e0e4/assets/c6f93252-1c46-11ea-af56-e368b99e9723.svg -->

<!--
На рисунке показаны наиболее распространенные проблемы с ACL. На рисунке показана 7-уровневая модель OSI с  с распространенными ошибками ACL  на транспортном уровне. Распространенными ошибками ACL являются выбор потока трафика, порядок записей ACL, Неявный deny any, шаблонные  маски IPv4-адресация, выбор протокола транспортного уровня, порты источника и назначения, Использование ключевого слова established и нестрандартные протоколы.
-->

Проблемы с ACL могут вызывать сбои в работе исправных систем. В таблице указаны несколько областей, где чаще всего встречаются ошибки настройки:

| **Некорректная настройка** | **Описание** |
| --- | --- |
| **Выбор потока трафика** | <ul><li>Трафик определяется интерфейсом маршрутизатора, через который передается, и направлением его передачи. </li><li>ACL-список должен применяться к нужному интерфейсу, а для обеспечения правильной работы необходимо правильно выбирать направление трафика.</li></ul> |
| **Порядок записей контроля доступа**  | <ul><li>Записи в ACL должны строго следовать в порядке от конкретных к общим. </li><li>Хотя ACL-список может иметь отдельную запись, разрешающую определенный поток трафика, пакеты никогда не будут сравниваться с ней, если они были уже отклонены записью, расположенной ранее в списке. </li><li>Если на маршрутизаторе одновременно применяются ACL и NAT, важен порядок применения этих технологий к потоку трафика. </li><li>Входящий трафик сначала обрабатывается входящим ACL-списком и только потом — NAT в направлении «снаружи внутрь». </li><li>Исходящий трафик сначала обрабатывается исходящим ACL-списком и только потом NAT в направлении «изнутри наружу».</li></ul> |
| **Неявное deny any**  | Если для списка контроля доступа высокий уровень безопасности не требуется, этот неявный элемент может стать причиной неправильной настройки списка. |
| **Адреса IPv4 и шаблонные маски**  | <ul><li>Сложные шаблонные маски IPv4 позволяют существенно повысить уровень эффективности, но часто связаны с ошибками настройки. </li><li>Пример сложной шаблонной маски — IPv4-адрес 10.0.32.0 и шаблонная маски 0.0.32.15 для выбора первых 15 адресов компьютеров либо в сети 10.0.0.0, либо в сети 10.0.32.0.</li></ul> |
| **Выбор протокола транспортного уровня**  | <ul><li>После настройки ACL важно правильно указать протоколы транспортного уровня. </li><li>Многие администраторы, не зная точно, какой порт (TCP или UDP) используется конкретным потоком трафика, настраивают оба порта. </li><li>В этом случае в межсетевом экране появляется «дырка», которой могут воспользоваться злоумышленники. </li><li>Кроме того, в списке контроля доступа также появляется дополнительный элемент, поэтому время обработки в списке контроля доступа возрастает, что приведет к увеличению задержки при передаче данных в сети.</li></ul> |
| **Порты источника и назначения**  | <ul><li>Для надлежащего контроля трафика между двумя компьютерами требуются симметричные элементы контроля доступа для входящего и исходящего ACL. </li><li>Информация об адресах и портах для трафика, создаваемого компьютером-ответчиком, является зеркальным отражением информации об адресах и портах для трафика, создаваемого компьютером-инициатором.</li></ul> |
| **Использование ключевого слова established**  | <ul><li>Ключевое слово **established** повышает информационную безопасность, обеспечиваемую списками контроля доступа. </li><li>Однако если ключевое слово применяется неправильно, результаты могут быть неожиданными.</li></ul> |
| **Нестандартные протоколы**  | <ul><li>Неправильно настроенные ACL часто создают проблемы для протоколов, отличных от TCP и UDP. </li><li>К специальным протоколам, которые становятся все более популярными, относятся VPN и протоколы шифрования.</li></ul> |

Ключевое слово **log** — полезная команда для вывода сведений о работе списка ACL на уровне его записей. В соответствии с ключевым словом маршрутизатор добавляет запись в системный журнал при каждом совпадении с условиями в этой записи. Зарегистрированное событие содержит подробную информацию о пакете, который соответствует элементу списка ACL. Ключевое слово **log** главным образом используется для поиска и устранения неполадок, а также предоставляет информацию о попытках вторжения, блокируемых с помощью ACL.

<!-- 12.4.5 -->
## Поиск и устранение неполадок на транспортном уровне — NAT для IPv4

Применительно к NAT могут появляться различные проблемы, например, невозможность взаимодействия со службами (такими как DHCP) и туннелированием. К ним могут относиться неправильно настроенные наружные и внутренние интерфейсы NAT или список ACL. Другие возможные проблемы — несовместимость с сетевыми технологиями, прежде всего содержащими или извлекающими информацию из адреса узла, указанного в пакете.

На рисунке приведены общие области взаимодействия с NAT.

![](./assets/12.4.5.svg)
<!-- /courses/ensa-dl/ae8eb396-34fd-11eb-ba19-f1886492e0e4/aeb65fd0-34fd-11eb-ba19-f1886492e0e4/assets/c6f9f5a2-1c46-11ea-af56-e368b99e9723.svg -->

<!--
На рисунке приведены общие области взаимодействия с NAT. На рисунке показана 7-уровневая модель OSI с общими областями взаимодействия на транспортном уровне. Распространенными областями взаимодействия являются протоколы BOOTP и DHCP, DNS и WINS, SNMP, протоколы  туннелирования и шифрования.
-->

В таблице приведены общие области взаимодействия с NAT.

| **Признак** | **Описание** |
| --- | --- |
| **BOOTP и DHCP** | <ul><li>Оба этих протокола позволяют управлять процессом автоматического назначения IPv4-адресов клиентам. </li><li>Первым новый клиент посылает широковещательный пакет IPv4 DHCP-Request. </li><li>Пакет DHCP-Request имеет IPv4-адрес источника 0.0.0.0. </li><li>Так как для NAT требуются действительные IPv4-адреса источника и назначения, протоколы BOOTP и DHCP могут испытывать трудности при взаимодействии с маршрутизатором, на котором выполняется статическое или динамическое преобразование NAT </li><li>Настройка помощника (helper) для IPv4 может помочь решить эту проблему.</li></ul> |
| **DNS**  | <ul><li>Так как роутер, на котором выполняется динамическое преобразование NAT, регулярно меняет взаимосвязь между внутренними и внешними адресами (по мере удаления и повторного создания записей в таблице), у сервера DNS за пределами маршрутизатора NAT нет точной информации о сети внутри роутера. </li><li>Настройка помощника (helper) для IPv4 может помочь решить эту проблему.</li></ul> |
| **SNMP**  | <ul><li>По аналогии с пакетами DNS таблица NAT не может изменять адресную информацию, которая хранится в части пакета, несущей полезную нагрузку. </li><li>Поэтому станция управления SNMP на одной стороне маршрутизатора NAT может быть неспособна связываться с агентами SNMP на другой стороне. </li><li>Настройка помощника (helper) для IPv4 может помочь решить эту проблему.</li></ul> |
| **Протоколы туннелирования и шифрования**  | <ul><li>Протоколам шифрования и туннелирования часто требуется, чтобы источником трафика был конкретный порт UDP или TCP, или же они используют протокол на транспортном уровне, который не может быть обработан таблицей NAT. </li><li>Например, протоколы туннелирования IPsec и GRE, используемые в реализациях VPN, не могут быть обработаны таблицей NAT.</li></ul> |

<!-- 12.4.6 -->
## Поиск и устранение неисправностей на уровне приложений

Большинство протоколов уровня приложений предоставляют пользовательские услуги. Эти протоколы обычно используют для управления сетями, передачи файлов, распределенных файловых сервисов, эмуляции терминалов и электронной почты. Во многих случаях добавляются пользовательские услуги, например сети VPN и VoIP.

На рисунке показаны самые известные и распространенные протоколы уровня приложений TCP/IP:

![](./assets/12.4.6.svg)
<!-- /courses/ensa-dl/ae8eb396-34fd-11eb-ba19-f1886492e0e4/aeb65fd0-34fd-11eb-ba19-f1886492e0e4/assets/c6fa6ad3-1c46-11ea-af56-e368b99e9723.svg -->

<!--
На рисунке показаны наиболее известные и распространенные протоколы уровня приложений TCP/IP: На рисунке показана 7-уровневая модель OSI с моделью TCP/IP, с протоколами на каждом уровне. На прикладном уровне модели TCP/IP и на прикладном уровне, уровне представления и  сеансовом уровне модели OSI используются следующие протоколы: HTTP, Telnet, FTP, TFTP, SMTP, POP, IMAP, SNMP, NTP, DNS, NNTP, NFS, XDR и RPC. На транспортном уровне модели TCP/IP и OSI находятся следующие протоколы TCP и UDP. На сетевом уровне  OSI и Интернет уровне  модели TCP/IP представлены следующие протоколы, протоколы маршрутизации, IP и ICMP. На канальном уровне модели TCP/IP и  OSI находятся следующие протоколы, ARP и ND. На физическом уровне модели TCP/IP & OSI находятся протоколы, не указанные на рисунке.
-->

В таблице приводится краткое описание этих протоколов прикладного уровня.

|  **Приложения** | **Описание** |
| --- | --- |
| **SSH/Telnet**  | Позволяет пользователям устанавливать подключения в виде сеансов терминала с удаленными компьютерами. |
| **HTTP**  | Поддерживает обмен текстом, графическими изображениями, звуком, видео и другими мультимедийными файлами по Интернету. |
| **FTP** | Реализует интерактивный обмен файлами между компьютерами. |
| **TFTP**  | Реализует базовые возможности интерактивного обмена файлами, обычно между компьютерами и сетевыми устройствами. |
| **SMTP**  | Поддерживает базовые услуги доставки сообщений. |
| **POP**  | Позволяет подключаться к почтовым серверам и загружать электронную почту. |
| **SNMP** | Позволяет собирать управляющую информацию от сетевых устройств. |
| **DNS**  | Сопоставляет IP-адреса с именами, назначенными сетевым устройствам. |
| **Сетевая файловая система (NFS)**  | Позволяет компьютерам монтировать диски на удаленных компьютерах и эксплуатировать их, как локальные диски. Первоначально разработанный компанией Sun Microsystems, он сочетается с двумя другими протоколами прикладного уровня, внешнее представление данных (XDR) и вызов удаленной процедуры (RPC), чтобы разрешить прозрачный доступ к ресурсам удаленной сети. |

Типы симптомов и причины зависят от самого приложения.

Проблемы на уровне приложений не позволяют предоставлять услуги прикладным программам. Они могут привести к недоступности или невозможности использования ресурсов (хотя остальные уровни работают нормально). Сеть может быть полностью работоспособна с точки зрения связи. Проблемы прикладного уровня препятствуют предоставлению услуг программам. Это может привести к тому, что ресурсы будут недоступны или непригодны для использования, когда физический, канальный, сетевой и транспортный уровни функционируют. Полное подключение к сети возможно, но приложение просто не может предоставить данные.

Другие проблемы на уровне приложений происходят, когда физический, канальный, сетевой и транспортный уровни функционируют нормально, но передача данных и запросы сетевых услуг из службы или приложения не соответствуют обычным ожиданиям пользователя.

Из-за проблем на уровне приложений пользователи могут начать жаловаться на нестабильную или медленную работу сети или конкретного приложения при передаче данных или запросе сетевых услуг.

<!-- 12.4.7 -->
<!-- quiz -->

