<!-- 5.3.1 -->
## Команда access-class

ACL обычно фильтруют входящий или исходящий трафик на интерфейсе. Однако его также можно использовать для защиты удаленного административного доступа к устройству на линиях VTY.

Выполните следующие шаги для защиты удаленного административного доступа к линиям VTY:

* создайте список ACL, чтобы определить, каким административным узлам должен быть разрешен удаленный доступ;
* примените ACL к входящему трафику на линиях VTY.

Чтобы применить ACL к строкам VTY, спользуйте следующую команду:

```
R1(config-line)# access-class {access-list-number | access-list-name} { in | out } 
```

Ключевое слово **in** является наиболее часто используемым вариантом для фильтрации входящего трафика на VTY. Параметр **out** фильтрует исходящий трафик VTY и редко применяется.

При настройке списка доступа к каналам VTY должны учитываться следующие положения:

* к VTY-линиям можно применять как именованные, так и нумерованные списки контроля доступа (ACL);
* одинаковые ограничения должны быть установлены на все каналы VTY, поскольку пользователь может попытаться подключиться к любому из них.

<!-- 5.3.2 -->
## Пример защищенного доступа VTY

Топология на рисунке используется для демонстрации того, как настроить ACL для фильтрации трафика VTY. В этом примере только PC1 будет разрешено подключение Telnet к R1.

**Примечание**. Telnet используется здесь только для демонстрационных целей. SSH следует использовать в производственной среде.

![](./assets/5.3.2.svg)
<!-- /courses/ensa-dl/ae8e8c84-34fd-11eb-ba19-f1886492e0e4/aeb46402-34fd-11eb-ba19-f1886492e0e4/assets/c6223342-1c46-11ea-af56-e368b99e9723.svg -->

<!--
Топология из 5.1.5 без применения списков ACL
-->

Чтобы увеличить безопасный доступ, будут созданы имя пользователя и пароль, метод аутентификации **login local** будет использоваться на линии VTY. Команда в примере создает запись локальной базы данных для пользователя **ADMIN** и пароля **class**.

Создается именованный стандартный ACL ADMIN-HOST, который идентифицирует PC1. Обратите внимание, что **deny any** был настроен для отслеживания количества раз, когда доступ был запрещен.

Линии VTY настроены на использование локальной базы данных для проверки подлинности, разрешение трафика Telnet и использование ACL ADMIN-HOST для ограничения трафика.

```
R1(config)# username ADMIN secret class
R1(config)# ip access-list standard ADMIN-HOST
R1(config-std-nacl)# remark This ACL secures incoming vty lines
R1(config-std-nacl)# permit 192.168.10.10
R1(config-std-nacl)# deny any
R1(config-std-nacl)# exit
R1(config)# line vty 0 4
R1(config-line)# login local
R1(config-line)# transport input telnet
R1(config-line)# access-class ADMIN-HOST in
R1(config-line)# end
R1#
```

В производственной среде вы должны установить линии VTY, чтобы разрешить только SSH, как показано в примере.

```
R1(config)# line vty 0 4
R1(config-line)# login local
R1(config-line)# transport input ssh
R1(config-line)# access-class ADMIN-HOST in
R1(config-line)# end
R1#
```

<!-- 5.3.3 -->
## Проверка защиты VTY-порта

После настройки ACL-списка для ограничения доступа к линиям VTY важно убедиться в его надлежащем функционировании.

Как показано на рисунке, при подключении PC1 к R1 хосту будет предложено ввести имя пользователя и пароль, прежде чем успешно получить доступ к командной строке.

![](./assets/5.3.3-1.png)

<!--
shows a Tera Term console window indicating that the remote SSH login was succesful
-->

Это подтверждает, что PC1 может получить доступ к R1 в административных целях.

Далее мы тестируем соединение с PC2. Как показано на этом рисунке, когда PC2 пытается подключиться к Telnet, соединение отклоняется.

![](./assets/5.3.3-2.png)

<!--
shows the Tera Term console connection was refused
-->

Чтобы проверить статистику ACL, выполните команду **show access-lists**. Обратите внимание на информационное сообщение, отображаемое на консоли относительно пользователя администратора. Сообщение информационной консоли также генерируется при выходе пользователя из строки VTY.

Совпадение в строке разрешения выходных данных является результатом успешного Telnet-соединения PC1. Совпадение в строке запрета является следствием неудачной попытки установить Telnet-подключение PC2 устройством в сети 192.168.11.0/24.

```
R1#
Oct  9 15:11:19.544: %SEC_LOGIN-5-LOGIN_SUCCESS: Login Success [user: admin] [Source: 192.168.10.10] [localport: 23] at 15:11:19 UTC Wed Oct 9 2019
R1# show access-lists
Standard IP access list ADMIN-HOST
    10 permit 192.168.10.10  (2 matches) 
    20 deny   any  (2 matches) 
R1#
```

<!-- 5.3.4 -->
<!-- syntax -->

