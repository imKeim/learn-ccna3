<!-- 1.4.1 -->
## Особенности и характеристики OSPF

**OSPF** — протокол маршрутизации по состоянию каналов, разработанный в качестве альтернативы протоколу на базе векторов расстояния RIP. Протокол OSPF имеет ряд значительных преимуществ в сравнении с протоколом RIP, обеспечивая более быструю сходимость и возможность масштабирования в целях реализации сетей большего размера. Протокол OSPF является бесклассовым, использующим концепцию разделения на области в целях масштабируемости. Канал — это интерфейс устройства, представляющий собой сегмент сети, который соединяет два устройства или заглушающую сеть, такую как Ethernet LAN, которая подключена к одному роутеру. Вся информация о состоянии канала включает префикс сети, его длину и стоимость. Все протоколы используют сообщения для обмена данными маршрутизации. Сообщения позволяют выстраивать структуры данных, которые впоследствии обрабатываются посредством алгоритма маршрутизации. Устройства, использующие OSPF, обмениваются сообщениями для передачи информации о маршрутизации с использованием пяти типов пакетов: 

- Hello;
- описания базы данных;
- запроса состояния канала;
- обновления состояния канала;
- подтверждения состояния канала. 

Сообщения OSPF используются для создания и обслуживания трех баз данных OSPF. База данных смежности создает таблицу соседей, база данных состояния каналов (LSDB) – таблицу топологии, база данных пересылки – таблицу маршрутизации. Устройство формирует таблицу топологии с использованием результатов вычислений, основанных на алгоритме кратчайшего пути (SPF) Дейкстры, который основывается на данных о совокупной стоимости доступа к точке назначения. В OSPF стоимость используется для определения наилучшего пути к месту назначения. Для предоставления данных маршрутизации роутеры, использующие протокол OSPF, выполняют следующие общие этапы маршрутизации по состоянию канала для достижения состояния сходимости.

1.  Установление отношений смежности с соседними устройствами.
2.  Обмен объявлениями о состоянии каналов.
3.  Создание базы данных состояния связи.
4.  Исполнение алгоритма SPF.
5.  Выбор лучшего маршрута.

При OSPF для одной области рекомендуется использовать область 0. OSPF для одной области рекомендуется использовать в малых сетях с небольшим количеством роутеров. При использовании протокола OSPF для нескольких областей один большой домен маршрутизации может быть разделен на меньшие области для реализации иерархической маршрутизации, при использовании которой выполняется маршрутизация между областями (межобластная), но многие из ее операций, потребляющих ресурсы процессора (повторный расчёт базы данных), выполняются в пределах одной области. OSPFv3 представляет собой эквивалент OSPFv2 для обмена префиксами IPv6. Следует помнить, что в IPv6 сетевой адрес называется префиксом, а маска подсети – длиной префикса.

## Пакеты OSPF

Протокол OSPF использует пакеты состояния канала для установления и поддержания отношений смежности и обмена обновлениями маршрутизации:

1. Hello;
2. DBD;
3. LSR;
4. LSU;
5. LSAck. 

Пакеты LSU также используются для пересылки обновлений маршрутизации OSPF, например данных об изменении канала. Пакеты приветствия используются в следующих целях:

* Обнаружение соседних устройств OSPF и установление отношений смежности с ними.
* Объявление параметров, при которых два маршрутизатора обязаны согласиться установить отношения смежности.
* В сетях с множественным доступом (Ethernet и Frame Relay) необходимо выбрать выделенный маршрутизатор (DR) и резервный выделенный маршрутизатор (BDR). Для каналов типа «точка-точка» наличие DR или BDR не требуется.

Некоторые важные поля в пакете Hello: тип, идентификатор маршрутизатора, идентификатор области, маска сети, интервал приветствия, приоритет маршрутизатора, мертвый интервал, DR, BDR и список соседей.

## Принципы работы OSPF

При первом подключении устройства OSPF к сети он пытается:

* установить отношения смежности с соседними узлами;
* осуществить обмен данными маршрутизации;
* рассчитать оптимальные маршруты;
* достичь состояния сходимости.

Состояние Down, состояние Init, состояние Two-Way, состояние ExStart, состояние Exchange, состояние Loading и состояние Full Когда OSPF включен на интерфейсе, маршрутизатор должен определить, есть ли другой сосед OSPF на канале, отправив пакет Hello, содержащий идентификатор маршрутизатора, из всех интерфейсов с поддержкой OSPF. Пакет Hello отправляется на зарезервированный адрес IPv4 многоадресной рассылки всех маршрутизаторов OSPF 224.0.0.5. Только маршрутизаторы OSPFv2 будут обрабатывать эти пакеты. Если соседний маршрутизатор, на котором активирован протокол OSPF, получает пакет приветствия с идентификатором маршрутизатора, который не включён в список его соседних устройств, принимающий маршрутизатор пытается установить с инициирующим маршрутизатором отношения смежности. После  состояния  Two-Way маршрутизаторы переходят в состояния синхронизации базы данных, что состоит из трех этапов:

1.  Определите первый маршрутизатор
2.  Обмен DBD
3.  Отправление LSR

Сети с множественным доступом могут повлечь за собой две сложности, связанные с лавинной рассылкой объявлений LSA: создание множественных отношений смежности и избыточная рассылка LSA. Резкое увеличение числа маршрутизаторов также значительно увеличивает количество LSA, которыми обмениваются маршрутизаторы. Этот флуд LSA значительно влияет на работу OSPF. Если бы все маршрутизаторы в сети множественного доступа должны были выполнять лавинную рассылку и подтверждать каждый полученный пакет LSA от всех остальных маршрутизаторов в пределах одной сети множественного доступа, сетевой трафик стал бы довольно хаотичным. Вот почему выборы в DR и BDR необходимы. В сетях множественного доступа протокол OSPF назначает выделенный маршрутизатор (DR) как точку сбора и распространения отправленных и принятых пакетов LSA. На случай сбоя выделенного маршрутизатора (DR) также выбирается резервный назначенный маршрутизатор (BDR).

<!-- 1.4.2 -->
<!-- quiz -->

