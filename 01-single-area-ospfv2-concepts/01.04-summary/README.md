<!-- 1.4.1 -->
## Особенности и характеристики OSPF

**OSPF** — протокол маршрутизации по состоянию каналов, разработанный в качестве альтернативы протоколу на базе векторов расстояния RIP. Протокол OSPF имеет ряд значительных преимуществ в сравнении с протоколом RIP, обеспечивая более быструю сходимость и возможность масштабирования в целях реализации сетей большего размера. Протокол OSPF является бесклассовым, использующим концепцию разделения на области в целях масштабируемости. Канал — это интерфейс устройства, представляющий собой сегмент сети, который соединяет два устройства или заглушающую сеть, такую как Ethernet LAN, которая подключена к одному роутеру. Вся информация о состоянии канала включает префикс сети, его длину и стоимость. Все протоколы используют сообщения для обмена данными маршрутизации. Сообщения позволяют выстраивать структуры данных, которые впоследствии обрабатываются посредством алгоритма маршрутизации. Устройства, использующие OSPF, обмениваются сообщениями для передачи информации о маршрутизации с использованием пяти типов пакетов: 

- hello;
- описания базы данных;
- запроса состояния канала;
- обновления состояния канала;
- подтверждения состояния канала. 

Сообщения OSPF используются для создания и обслуживания трех баз данных OSPF. База данных смежности создает таблицу соседей, база данных состояния каналов (LSDB) – таблицу топологии, база данных пересылки – таблицу маршрутизации. Устройство формирует таблицу топологии с использованием результатов вычислений, основанных на алгоритме кратчайшего пути (SPF) Дейкстры, который основывается на данных о совокупной стоимости доступа к точке назначения. В OSPF стоимость используется для определения наилучшего пути к месту назначения. Для предоставления данных маршрутизации роутеры, использующие протокол OSPF, выполняют следующие общие этапы маршрутизации по состоянию канала для достижения состояния сходимости.

1.  Установление отношений смежности с соседними устройствами.
2.  Обмен объявлениями о состоянии каналов.
3.  Создание базы данных состояния связи.
4.  Исполнение алгоритма SPF.
5.  Выбор лучшего маршрута.

При OSPF для одной области рекомендуется использовать область 0. OSPF для одной области рекомендуется использовать в малых сетях с небольшим количеством роутеров. При использовании протокола OSPF для нескольких областей один большой домен маршрутизации может быть разделен на меньшие области для реализации иерархической маршрутизации, при использовании которой выполняется маршрутизация между областями (межобластная), но многие из ее операций, потребляющих ресурсы процессора (повторный расчёт базы данных), выполняются в пределах одной области. OSPFv3 представляет собой эквивалент OSPFv2 для обмена префиксами IPv6. Следует помнить, что в IPv6 сетевой адрес называется префиксом, а маска подсети – длиной префикса.

## Пакеты OSPF

Протокол OSPF использует пакеты состояния канала для установления и поддержания отношений смежности и обмена обновлениями маршрутизации:

1. hello;
2. DBD;
3. LSR;
4. LSU;
5. LSAck. 

Пакеты LSU также используются для пересылки обновлений маршрутизации OSPF, например данных об изменении канала. Пакеты приветствия используются в следующих целях:

* обнаружение соседних устройств OSPF и установление отношений смежности с ними;
* объявление параметров, при которых два роутера обязаны согласиться установить отношения смежности;
* в сетях с множественным доступом (Ethernet и Frame Relay) необходимо выбрать выделенный (DR) и резервный выделенный роутеры (BDR). Для каналов типа «точка-точка» наличие DR или BDR не требуется.

Важные поля в пакете Hello: тип, идентификатор маршрутизатора, идентификатор области, маска сети, интервал приветствия, приоритет роутера, мертвый интервал, DR, BDR и список соседей.

## Принципы работы OSPF

При первом подключении устройства OSPF к сети он пытается:

* установить отношения смежности с соседними узлами;
* осуществить обмен данными маршрутизации;
* рассчитать оптимальные маршруты;
* достичь состояния сходимости.

Состояния Down, Init, Two-Way, ExStart, Exchange, Loading и Full. Когда OSPF включен на интерфейсе, роутер должен определить, есть ли другой сосед OSPF на канале, отправив пакет Hello, содержащий его идентификатор, из всех интерфейсов с поддержкой OSPF. Пакет Hello отправляется на зарезервированный адрес IPv4 многоадресной рассылки всех устройств OSPF 224.0.0.5. Только роутеры OSPFv2 будут обрабатывать эти пакеты. Если соседний роутер, на котором активирован протокол OSPF, получает пакет приветствия с идентификатором устройства, который не включён в список его соседних устройств, принимающий роутер пытается установить с инициирующим отношения смежности. После состояния Two-Way устройства переходят в состояния синхронизации базы данных, что состоит из трех этапов:

1.  определение первого роутера;
2.  обмен DBD;
3.  отправка LSR.

Сети с множественным доступом могут повлечь за собой сложности, связанные с лавинной рассылкой объявлений LSA: создание множественных отношений смежности и избыточная рассылка LSA. Резкое увеличение числа устройств также значительно увеличивает количество LSA, которыми обмениваются роутеры. Это значительно влияет на работу OSPF, так как если бы все устройства в сети множественного доступа должны были выполнять лавинную рассылку и подтверждать каждый полученный пакет LSA от всех остальных роутеров в пределах одной сети множественного доступа, сетевой трафик стал бы довольно хаотичным. Поэтому необходим выбор DR и BDR, так в сетях множественного доступа протокол OSPF назначает выделенный роутер (DR) как точку сбора и распространения отправленных и принятых пакетов LSA. На случай сбоя DR также выбирается резервный назначенный роутер (BDR).

<!-- 1.4.2 -->
<!-- quiz -->

