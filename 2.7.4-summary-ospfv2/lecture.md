<!-- 2.7.4 -->
##  Что я изучил в этом модуле?

**Идентификатор маршрутизатора OSPF**

OSPFv2 включается с помощью команды режима глобальной настройки **router ospf** *process-id*. Значение *process-id* представляет собой число от 1 до 65535 и выбирается сетевым администратором. Идентификатор маршрутизатора OSPF — это 32-разрядное значение, представленное в формате адреса IPv4. Идентификатор маршрутизатора используется маршрутизатором с поддержкой OSPF для синхронизации баз данных OSPF и участия в выборе DR и BDR. Маршрутизаторы Cisco получают идентификатор маршрутизатора на основе одного из трех критериев в следующем предпочтительном порядке:

1.  Идентификатор задается с помощью команды **router-id** *rid*, выполняемой в режиме конфигурации маршрутизатора OSPF представляет собой любое 32-разрядное число в формате адреса IPv4.
2.  Если идентификатор маршрутизатора не настроен напрямую, маршрутизатор выбирает самое высокое значение IPv4-адреса любого из настроенных интерфейсов loopback.
3.  При отсутствии настроенных интерфейсов loopback маршрутизатор выбирает самое высокое значение активного IPv4-адреса любого из своих физических интерфейсов.

Идентификатор маршрутизатора также можно назначить, используя интерфейс loopback. IPv4-адрес для этого типа интерфейса обратной связи должен быть настроен с использованием 32-битной маски подсети (255.255.255.255), создающей маршрут хоста. 32-битный маршрут узла не объявляется в качестве маршрута для других маршрутизаторов OSPF. После того, как маршрутизатор выбирает идентификатор маршрутизатора, активный маршрутизатор OSPF не позволяет изменять идентификатор маршрутизатора, пока маршрутизатор не будет перезагружен или процесс OSPF не будет сброшен. Используйте  команду **clear ip ospf process** для сброса смежности. Затем можно убедиться в том, что R1 использует  новый router ID с  командой **show ip protocols** с фильтром  для отображения только раздела идентификатора маршрутизатора.

**Сети OSPF типа «точка-точка»**

Команда network определяет, какие интерфейсы участвуют в процессе маршрутизации для области OSPFv2. Базовый синтаксис  команды - **network** **network**_network-address_ _wildcard-mask_ **area** _area-id._ Любые интерфейсы маршрутизатора, соответствующие сетевому адресу в **network** команде, могут отправлять и принимать пакеты OSPF. При настройке конфигурации OSPFv2 для одной области команда **network** должна использоваться с одним и тем же значением Шаблонная  маска обычно является обратной маской подсети, настроенной на этом интерфейсе. В шаблонной  маске

* **Бит 0 шаблонной маски**  — совпадает с соответствующим значением бита в адресе.
* **Бит 1 шаблонной маски** — игнорирует соответствующее значение бита в адресе.

В режиме конфигурации маршрутизации существует два способа определения интерфейсов, которые будут участвовать в процессе маршрутизации OSPFv2. Один из способов заключается в том, что  шаблонная маска идентифицирует интерфейс на основе сетевых адресов. Любой активный интерфейс, настроенный с адресом IPv4, принадлежащим этой сети, будет участвовать в процессе маршрутизации OSPFv2. Другой способ - OSPFv2 может быть включен, указав точный адрес IPv4 интерфейса с помощью маски из четырех нулей . Чтобы настроить OSPF непосредственно на интерфейсе, используйте команду конфигурации интерфейса **ip ospf**. Синтаксис **ip ospf** _process-id_ **area** _area-id._ Отправка нежелательных сообщений по локальной сети влияет на сеть из-за неэффективного использования полосы пропускания и ресурсов и создает повышенный риск безопасности. Используйте команду режима конфигурации маршрутизатора **passive-interface**, чтобы запретить передачу сообщений маршрутизации посредством интерфейса маршрутизатора и при этом разрешить объявление этой сети для других маршрутизаторов, как показано на рис. 1. Затем  команда **show ip protocols** используется для проверки того, что интерфейс Loopback 0 указан как пассивный. Процесс выборов DR/BDR не нужен, так как в сети точка-точка между R1 и R2 может быть только два маршрутизатора. Используйте команду конфигурации интерфейса для всех интерфейсов, **ip ospf network point-to-point** на которых требуется отключить процесс выбора DR/BDR. Используйте петли для моделирования большего количества сетей, чем может поддерживать оборудование. По умолчанию интерфейсы loopback объявляются как хост-маршруты /32. Для имитации реальной локальной сети интерфейс Loopback 0 настраивается как сеть точка-точка.

**Типы сетей OSPF**

Маршрутизаторы могут быть подключены к одному и тому же коммутатору для формирования сети с множественным доступом. Локальные сети Ethernet — это наиболее распространённый пример широковещательных сетей множественного доступа. В широковещательных сетях все устройства в рамках сети видят все широковещательные кадры и кадры групповой рассылки. DR отвечает за сбор и распространение LSAs. DR использует IPv4-адрес многоадресной рассылки 224.0.0.5, который предназначен для всех маршрутизаторов OSPF. Если DR перестает создавать пакеты приветствия (hello), то BDR самостоятельно принимает роль DR. Все остальные маршрутизаторы приобретают статус маршрутизаторов DROthers. DROTHER используют адрес с несколькими доступом 224.0.0.6 (все назначенные маршрутизаторы) для отправки пакетов OSPF в DR и BDR. Только DR и BDR прослушивают 224.0.0.6. Для проверки ролей маршрутизатора OSPFv2 используйте команду **show ip ospf interface**. Для проверки отношений смежности OSPFv2 используйте команду **show ip ospf neighbor**. У соседей в сетях со множественным доступом могут быть следующие состояния:

* **FULL/DROTHER** - это выделенный маршрутизатор DR или резервный выделенный маршрутизатор BDR, который полностью смежен с не выделенным маршрутизатором (не DR и не BDR).
* **FULL/DR** - маршрутизатор, полностью смежный с указанным соседом DR.
* **FULL/BDR** - маршрутизатор, полностью смежный с указанным соседом BDR.
* **2-WAY/DROTHER** - это не выделенный маршрутизатор (не DR и не BDR), у которого имеются отношения смежности с другим невыделенным маршрутизатором (не DR и не BDR).

Выбор ролей DR и BDR по протоколу OSPF основывается на следующих критериях в указанной очередности:

1.  Маршрутизаторы в сети выбирают маршрутизатор с самым высоким приоритетом интерфейса в качестве DR. Маршрутизатор со вторым по величине приоритетом интерфейса становится BDR. Приоритет может быть представлен любым числом от 0 до 255. Если значение приоритета интерфейса равно 0, этот интерфейс не может быть выбран как DR или BDR. Приоритет по умолчанию интерфейсов, подключенных к широковещательной сети множественного доступа, равен 1. Соответственно, при отсутствии иных настроек, все маршрутизаторы обладают равным приоритетом, и для выборов DR/BDR будет использоваться другой метод.
2.  Если приоритеты интерфейсов равны, то в качестве DR будет выбран маршрутизатор с наивысшим идентификатором. Маршрутизатор со вторым по величине идентификатором становится BDR.

Процесс выбора DR и BDR по протоколу OSPF не является вытесняющим. Если происходит сбой DR, то его роль автоматически перенимает BDR. Это происходит даже в том случае, если после первоначального выбора DR/BDR к сети добавляется другой маршрутизатор DROTHER с более высоким идентификатором или приоритетом. Однако когда BDR перенимает роль DR, происходит новый выбор BDR и его роль получает маршрутизатор DROTHER с высоким идентификатором или приоритетом. Для задания приоритета интерфейса используйте команду **ip ospf priority** _value_, где значение от 0 до 255. Если значение равно 0, маршрутизатор не станет DR или BDR. 1–255 — чем выше значение приоритета, тем больше вероятность того, что маршрутизатор станет DR или BDR на данном интерфейсе.

**Изменение OSPFv2 для одной области**

Протокол OSPF использует стоимость в качестве метрики. Путь с более низкой стоимостью является оптимальным по сравнению с путём с более высокой стоимостью. Стоимость интерфейса обратно пропорциональна его пропускной способности. Следовательно, более высокая пропускная способность указывает на более низкую стоимость. Формула, используемая для расчета стоимости OSPF: Стоимость = базовая пропускная способность /пропускная способность интерфейса. Обратите внимание, что интерфейсы FastEthernet, Gigabit Ethernet и 10 GigE используют одинаковое значение стоимости, поскольку значение стоимости OSPF должно быть целым числом. Чтобы исправить эту ситуацию, можно настроить опорную пропускную способность с  помощью команды  **auto-cost reference-bandwidth** на каждом маршрутизаторе OSPF или вручную задать значение стоимости OSPF с помощью  команды **ip ospf cost**. Чтобы отрегулировать эталонную пропускную способность, используйте команду конфигурации маршрутизатора **auto-cost reference-bandwidth** Mb/s. Стоимость маршрута OSPF представляет собой накопленное значение от одного маршрутизатора до сети назначения. Значения стоимости OSPF можно манипулировать, чтобы повлиять на маршрут, выбранный OSPF. Чтобы изменить отчет о стоимости локальным маршрутизатором OSPF на другие маршрутизаторы OSPF, используйте команду конфигурации интерфейса **ip ospf cost** _value_. Если интервал простоя истекает до получения маршрутизатором пакета приветствия, то OSPF удаляет это соседнее устройство из своей базы данных состояний каналов (LSDB). Маршрутизатор выполняет лавинную рассылку базы данных состояний каналов, содержащей данные о неработающем соседнем устройстве, из всех интерфейсов, использующих OSPF. Cisco использует по умолчанию 4 раза больше интервала приветствия или 40 секунд в сетях с коллективным доступом и точка-точка сетях. Чтобы проверить интервал интерфейса OSPFv2, используйте  команду **show ip ospf interface**. Интервалы приветствия (hello) и простоя (dead) OSPFv2 можно изменить вручную с помощью следующих команд режима интерфейсной настройки: **ip ospf hello-interval** seconds и **ip ospf dead-interval** seconds

**Распространение маршрута по умолчанию**

Однако в терминологии OSPF маршрутизатор, расположенный между доменом маршрутизации OSPF и сетью без OSPF, также называют граничным маршрутизатором автономной системы (ASBR). Для распространения маршрута по умолчанию ASBR должен быть настроен статический маршрут по умолчанию с помощью команды **ip route 0.0.0.0 0.0.0.0** _\[next-hop-address_ | _exit-intf\]_ и команды конфигурации  маршрутизатора **default-information originate**. Благодаря этому параметру маршрутизатор  становится источником информации о маршруте по умолчанию и распространяет статический маршрут по умолчанию в обновлениях OSPF. Проверьте настройки маршрута по умолчанию на ASBR с помощью команды **show ip route**.

**Проверка работы OSPFv2 для одной области**

Следующие две команды используются для проверки маршрутизации:

* **show ip interface brief** — используется для проверки того, что необходимые интерфейсы активны с правильной IP-адресацией.
* **show ip route** - используется для проверки того, что таблица маршрутизации содержит все ожидаемые маршруты.

Дополнительные команды для определения того, что OSPF работает должным образом, включают: **show ip ospf neighbor**, **show ip protocols**, **show ip ospf** и **show ip ospf interface**.

Используйте команду **show ip ospf neighbor**, чтобы убедиться, что маршрутизатор сформировал отношения смежности с соседними маршрутизаторами. Для каждого соседнего устройства данная команда отображает следующие выходные данные:

* **Neighbor ID** - идентификатор соседнего маршрутизатора.
* **Pri** - приоритет интерфейса OSPFv2. Это значение используется при выборе маршрутизаторов DR и BDR.
* **State** - состояние интерфейса OSPFv2. Состояние FULL означает, что данный и соседний маршрутизаторы имеют одинаковые базы данных состояния каналов OSPFv2. В сетях с множественным доступом (например, Ethernet) состояние двух маршрутизаторов, состоящих в отношениях смежности, может отображаться как 2WAY. Тире указывает на то, что использование в данном типе сети выделенного маршрутизатора DR или резервного выделенного маршрутизатора BDR не требуется.
* **Dead Time** - время, в течение которого маршрутизатор ожидает получения пакета приветствия OSPFv2 перед тем, как объявить соседнее устройство неработающим. Данное значение сбрасывается при получении интерфейсом пакета приветствия.
* **Address** - IPv4-адрес интерфейса соседнего устройства, к которому напрямую подключен этот маршрутизатор.
* **Interface** - интерфейс, на котором этот маршрутизатор установил отношения смежности с соседним устройством.

Команда **show ip protocols** позволяет быстро проверить важную информацию о конфигурации OSPF, такую как идентификатор процесса OSPFv2, идентификатор маршрутизатора, интерфейсы, явно настроенные для объявления маршрутов OSPF, соседи, с которых маршрутизатор получает обновления, и административное расстояние по умолчанию, равное 110 для OSPF. Используйте команду **show ip ospf** для проверки идентификатора процесса OSPF и идентификатора маршрутизатора. Эта команда отображает данные области OSPFv2 и показывает время последнего расчета алгоритма SPF. Эта команда **show ip ospf interface** выводит подробный список для каждого интерфейса, где включен OSPFv2. Укажите интерфейс только для одного интерфейса для отображения идентификатора процесса, идентификатора локального маршрутизатора, типа сети, стоимости OSPF, информации о DR и BDR на многоканальных каналах и соседних соседях.

<!-- 2.7.5 -->
<!-- quiz -->

