<!-- 6.3.1 -->
## Преимущества NAT

NAT решает нашу проблему отсутствия достаточного количества адресов IPv4, но это может создавать другие проблемы. В этом разделе рассматриваются преимущества и недостатки NAT.

NAT обеспечивает множество преимуществ, в том числе следующие.

* Сохраняет официально зарегистрированную схему адресации, разрешая частное использование внутренних сетей. Экономит адреса благодаря мультиплексированию приложений на уровне портов. При использовании NAT с перегрузкой (PAT) внутренние узлы могут использовать для всех внешних взаимодействий один публичный IPv4-адрес. При этом типе настройки для поддержки множества внутренних узлов требуется очень небольшое количество внешних адресов.
* Повышает гибкость подключений к публичной сети. Для обеспечения надежных подключений к публичной сети можно создать множественные пулы, резервные пулы и пулы распределения нагрузки.
* Обеспечивает постоянство схем внутренней сетевой адресации. Если в сети не используются частные IPv4-адреса и NAT, изменение схемы публичных IPv4-адресов потребует изменения адресов всех узлов существующей сети. Затраты на изменение адресации узлов могут оказаться существенными. NAT позволяет сохранить существующую схему частных IPv4-адресов, одновременно поддерживая простой переход на новую схему публичной адресации. Это означает, что организация может сменить интернет-провайдера, не меняя настроек своих внутренних клиентов.
* Используя адреса IPv4 RFC 1918, NAT скрывает адреса IPv4 пользователей и других устройств. Некоторые считают это функцией безопасности, однако большинство экспертов утверждают, что преобразование NAT не обеспечивает безопасность. Межсетевой экран с контролем состояния подключений — вот что обеспечивает безопасность на границе сети.

<!-- 6.3.2 -->
## Недостатки NAT

NAT имеет ряд недостатков. Тот факт, что узлы в Интернете взаимодействуют непосредственно с устройством, поддерживающим NAT, а не с фактическим узлом частной сети, создает ряд проблем.

Один из недостатков использования NAT связан с производительностью сети, особенно это касается протоколов реального времени, таких как VoIP. NAT увеличивает задержки пересылки, поскольку преобразование каждого IPv4-адреса в заголовках пакетов требует времени. Коммутация первого пакета диалога всегда является программным процессом — этот пакет всегда проходит более медленным путем. Роутер должен анализировать каждый пакет, чтобы решить, требуется ли его преобразование. Он также должен изменить заголовок IPv4 и, возможно, изменить заголовок TCP или UDP. При каждом преобразовании должна быть пересчитана контрольная сумма заголовка IPv4, а также контрольная сумма TCP или UDP. Если в кэше есть соответствующая запись, остальные пакеты проходят по пути для быстрой коммутации. В противном случае они тоже задерживаются.

Эта проблема усугубляется, поскольку пулы публичных адресов IPv4 для интернет-провайдеров истощаются. Многие интернет-провайдеры вынуждены назначать клиентам частный адрес IPv4 вместо публичного адреса IPv4. Это означает, что роутер клиента переводит пакет с частного адреса IPv4 на частный адрес IPv4 поставщика услуг Интернета. Прежде чем переадресовать пакет другому поставщику, поставщик услуг Интернета снова выполнит NAT, переведя свои частные IPv4-адреса в один из своих ограниченного числа публичных IPv4-адресов. Этот процесс преобразования двух уровней NAT известен как NAT класса несущей (Carrier Grade NAT, CGN).

Другим недостатком использования NAT является потеря сквозной адресации. Это называется сквозной коннективностью. Многие интернет-протоколы и приложения зависят от сквозной адресации от источника до узла назначения. Некоторые приложения не совместимы с NAT. Например, некоторые приложения безопасности, такие как цифровые подписи, не работают с NAT, поскольку IPv4-адрес источника изменяется по пути к узлу назначения. Приложения, использующие физические адреса вместо доменных имен, не могут достигнуть узлов назначения при прохождении через роутер с NAT. В некоторых случаях этой проблемы можно избежать с помощью статических сопоставлений NAT.

Кроме того, утрачивается возможность сквозной трассировки IPv4. Очень сильно усложняется трассировка пакетов, подвергающихся многочисленным изменениям адреса пакета при прохождении нескольких участков NAT, что, в свою очередь, затрудняет устранение неполадок.

Использование NAT также усложняет работу с туннельными протоколами, такими как IPsec, поскольку преобразование NAT изменяет значения в заголовках, что приводит к сбою проверки целостности.

Работа служб, требующих инициализации подключений TCP из внешней сети или использующих протоколы без учета состояния, например, на основе UDP, может быть нарушена. Если на роутере NAT не настроена поддержка таких протоколов, входящие пакеты не смогут достичь своего назначения. Некоторые протоколы могут поддерживать один экземпляр NAT между узлами-участниками (например, FTP в пассивном режиме), но не работают, если обе системы отделены от Интернета посредством NAT.

<!-- 6.3.3 -->
<!-- quiz -->

