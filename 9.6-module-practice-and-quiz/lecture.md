<!-- 9.6.1 -->
##  Что я изучил в этом модуле?

**Качество передачи данных по сети**

Передача голоса и видео в прямом эфире создает более высокие ожидания в отношении качества доставки среди пользователей и создает потребность в качестве обслуживания (QoS). При агрегации нескольких каналов связи на одном устройстве, например маршрутизаторе, когда большая часть этих данных затем передается на меньшее число исходящих интерфейсов или на более медленный интерфейс, может возникнуть перегрузка сети. Это может также произойти, когда большие пакеты данных препятствуют своевременной передаче более мелких пакетов. Без использования механизмов качества обслуживания пакеты обрабатываются в порядке их получения. В случае перегрузки сетевые устройства, такие как маршрутизаторы и коммутаторы, могут отбрасывать пакеты. Это означает, что пакеты, чувствительные к задержкам, например голосовой связи и видео в режиме реального времени, будут отбрасываться так же часто, как и данные, которые нечувствительны к задержкам, например электронная почта и страницы, просматриваемые в Интернете. Когда объем трафика превышает возможности доставки по сети, устройства помещают пакеты в очередь в памяти и удерживают их до тех пор, пока не будут доступны ресурсы передачи. Постановка пакетов в очередь приводит к задержке, поскольку новые пакеты не могут передаваться до тех пор, пока не будут обработаны предыдущие. Метод QoS, который может помочь в решении этой проблемы, заключается в распределении данных по нескольким очередям, как показано на этом рисунке. Точки перегрузки сети являются идеальными кандидатами для механизмов QoS для снижения задержек и задержек. Задержки бывают фиксированные и переменные. Задержка кодирования, задержка пакетирования, задержка в очереди, задержка сериализации, задержка распространения, задержка устранения джиттера. Джиттер — это разница в задержке полученных пакетов. В результате перегруженности сети, некорректной организации очереди или ошибок конфигурации время задержки для каждого пакета может меняться. И задержку, и джиттер необходимо контролировать и минимизировать, чтобы поддерживать интерактивный трафик в реальном времени.

**Характеристики трафика**

Трафик голосовых данных и видеотрафик предъявляют высокие требования к сети и являются двумя основными причинами реализации QoS. Голосовой трафик плавный и доброкачественный, но чувствителен к отбросу и задержкам. При передаче голоса допустимы определенные задержки, джиттер и потери без каких-либо заметных эффектов. Задержка не должна превышать 150 миллисекунд (мс). Джиттер не должен превышать 30 мс, а потеря голосовых пакетов — 1 %. Для трафика голосовых данных требуется пропускная способность не менее 30 Кбит/с. Видеотрафик более требователен, чем голосовой, из-за размера пакетов, которые он отправляет по сети. Видеотрафик является пульсирующим, ресурсоемким, чувствительным к потерям и задержкам и имеет высокий приоритет UDP Без применения функции качества обслуживания (QoS) и без значительного превышения требуемой полосы пропускания качество передачи видео обычно снижается. Портам UDP, например 554, которые используются для протокола потоковой передачи в режиме реального времени (RSTP), необходимо присвоить более высокий приоритет относительно другого сетевого трафика, менее чувствительного к задержкам. Видео, как и голос, может допускать определенный уровень задержки, джиттера и потерь без каких-либо заметных последствий. Задержка не должна превышать 400 миллисекунд (мс). Джиттер не должен превышать 50 мс, а потеря видеопакетов — 1 %. Для видеотрафика требуется пропускная способность не менее 384 Кбит/с. Трафик данных не так требователен, как голосовой и видеотрафик. Пакеты данных часто используют приложения TCP, которые могут ретранслировать данные и поэтому не чувствительны к падению и задержкам. Хотя трафик данных менее чувствителен к потерям и задержкам, чем голосовой трафик и видеотрафик, сетевому администратору необходимо учитывать качество взаимодействия с пользователями (QoE). Два основных фактора, которые администратор сети должен спросить о потоке трафика данных, являются ли данные получены из интерактивного приложения и если данные критически важны.

**Алгоритмы организации очереди**

Политика качества обслуживания, реализованная сетевым администратором, становится активной при возникновении затора в канале связи. Организация очереди является средством управления затором, которое может выполнять буферизацию, приоритизацию и, если необходимо, изменение порядка пакетов перед их передачей адресату. Этот курс посвящен следующим алгоритмам очередей: первый вход, первый выход (FIFO), взвешенная справедливая очередь (WFQ), взвешенная справедливая очередь на основе классов (CBWFQ) и очередь с низкой задержкой (LLQ). Алгоритм формирования очереди пакетов, в котором пакеты помещаются в буфер и пересылаются в порядке их получения. В FIFO нет концепции приоритета или классов трафика и, следовательно, не принимаются решения о приоритете пакетов. Когда используется FIFO, важный или чувствительный к задержкам трафик может отбрасываться при возникновении затора в интерфейсе коммутатора или маршрутизатора. WFQ является автоматизированным методом планирования, который обеспечивает справедливое выделение полосы пропускания всему сетевому трафику. Для классификации трафика и разделения его на сеансы, или потоки, в алгоритме WFQ применяются приоритеты, или взвешенность. WFQ классифицирует трафик, разделяя его на различные потоки с учетом адресации заголовков пакетов, включая такие характеристики, как IP-адреса источника и назначения, MAC-адреса, номера портов, протокол и значение типа обслуживания (Type of Service, ToS). Значение ToS в IP-заголовке может использоваться для классификации трафика. Алгоритм CBWFQ обладает более широкими возможностями, чем стандартный алгоритм WFQ, за счет поддержки определенных пользователем классов трафика. Используя CBWFQ, вы определяете классы трафика на основе критериев соответствия, в том числе протоколов, ACL-списков и входных интерфейсов. Функция LLQ определяет строгий порядок формирования очередей по приоритетам (PQ) для CBWFQ. Строгий порядок формирования очередей (PQ) позволяет отправлять чувствительные к задержке данные, например голос, перед пакетами в других очередях.

**Модели обеспечения качества обслуживания**

Три модели реализации качества обслуживания: модель без гарантированной доставки, интегрированный сервис (IntServ) и дифференцированные услуги (DiffServ). Модель Best-effort является наиболее масштабируемой, но не гарантирует доставку и не дает какого-либо пакетного преференциального режима. Потребности приложений реального времени, таких как потоковая видеопередача, мультимедийные конференции, визуализация и виртуальная реальность, явились стимулом к разработке модели архитектуры IntServ, осуществленной в 1994 г. (RFC 1633, 2211 и 2212). Модель IntServ — это модель, обеспечивающая несколько уровней качества обслуживания. IntServ явно управляет сетевыми ресурсами для обеспечения качества обслуживания отдельных потоков или потоков, иногда называемых микропотоками. В этой модели в качестве базовых компонентов используются механизмы резервирования ресурсов и контроля доступа, которые позволяют определять политику качества обслуживания и обеспечивать ее выполнение. Модель дифференцированных сервисов (DiffServ) определяет простой и масштабируемый механизм для классификации и управления сетевым трафиком и гарантии качества обслуживания в современных IP-сетях. Модель DiffServ лишена тех ограничений, которые свойственны модели без гарантированной доставки и IntServ. Модель DiffServ предоставляет «почти гарантированное» качество обслуживания и при этом является недорогой и масштабируемой. DiffServ делит сетевой трафик на классы, основываясь на требованиях бизнеса. После этого каждому классу можно назначить свой уровень обслуживания. При прохождении пакетов по сети каждое сетевое устройство определяет класс пакета и обрабатывает этот пакет в соответствии с требованиями для данного класса. Модель DiffServ предусматривает выбор из нескольких уровней обслуживания.

**Способы обеспечения качества обслуживания**

Инструменты реализации гарантированной полосы пропускания можно разбить на 3 общие категории: инструменты классификации и маркирования, инструменты предотвращения затора и инструменты управления перегруженностью. Чтобы применить политику качества обслуживания к пакету, пакет нужно классифицировать. Классификация и маркировка позволяют идентифицировать или «маркировать» типы пакетов. Классификация определяет класс трафика, к которому относятся пакеты или кадры. При классификации потоков трафика на уровне 2 и 3 используются интерфейсы, списки контроля доступа и карты классов. Трафик также можно классифицировать на уровнях с 4-го по 7-й с помощью распознавания приложений по параметрам сетевого трафика (Network Based Application Recognition, NBAR). Тип службы (IPv4) и класс трафика (IPv6) несут маркировку пакетов, назначенную средствами классификации QoS. Получающие устройства сверяются с этим полем для пересылки пакетов на основании соответствующей назначенной политики качества обслуживания. Эти поля имеют 6 бит, выделенных для QoS. Оно называется полем точки кода дифференцирования трафика (DSCP) и за счет этих 6 бит предлагает до 64 возможных классов обслуживания. Получающие устройства сверяются с этим полем для пересылки пакетов на основании соответствующей назначенной политики качества обслуживания. 64 значения DSCP разделены на три категории: Best-Effort (BE), Expedited Forwarding (EF), Assured Forwarding (AF). Поскольку первые три самые старшие бита поля точки кода дифференцированных услуг определяют класс, эти биты также называются битами селектора класса (Class Selector). Трафик нужно классифицировать и маркировать настолько близко к источнику, насколько это оправдано с технической и административной точки зрения. Это определяет границу доверия, как показано на рисунке. Управление заторами предусматривает планирование и формирование очередей, предполагающих буферизацию лишнего трафика или помещение его в очередь (а иногда и удаление) на время ожидания отправки такого трафика на выходном интерфейсе. Инструменты предотвращения перегрузок отслеживают распределение сетевого трафика с целью предугадать и предотвратить возникновение заторов в узких местах общей сети до того, как возникнет серьезная проблема. ПО Cisco IOS включает механизм взвешенного произвольного раннего обнаружения (Weighted Random Early Detection, WRED) как возможное решение для предотвращения заторов. Алгоритм WRED позволяет избегать заторов на сетевых интерфейсах за счет предоставления инструментов управления буферизацией и снижения или отбрасывания трафика TCP до того, как буфер будет переполнен. Шейпинг трафика и полисинг трафика — это механизмы Cisco IOS, позволяющие предотвращать заторы.

<!-- 9.6.2 -->
<!-- quiz -->

