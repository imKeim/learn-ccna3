<!-- 4.2.1 -->
##  Обзор шаблонной маски

В предыдущей теме вы узнали о назначении ACL. В этом разделе объясняется, как ACL использует шаблонные маски. IPv4 ACE использует 32-разрядную шаблонную маску, чтобы определить, какие биты адреса необходимо проверить на соответствие. Шаблонные маски также используются протоколом маршрутизации OSPF (Open Shortest Path First).

Шаблонная маска аналогично маске подсети использует процесс сопоставления для определения того, какие биты IPv4-адреса длны совпадать. Однако они отличаются соответствием двоичным числам 1 и 0. В маске подсети: 1 определяет совпадение, а 0 — несовпадение, в шаблонной маске — наоборот.

Шаблонные маски для сопоставления двоичных 1 и 0 используют следующие правила:

* **бит 0 шаблонной маски** — совпадает с соответствующим значением бита в адресе;
* **бит 1 шаблонной маски** — игнорирует соответствующее значение бита в адресе.

В таблице перечислены некоторые примеры шаблонных масок и то, что они идентифицируют.

| **Шаблонная маска** | **Последний октет (в двоичной системе)** | **Значение (0 — совпадение, 1 — игнорирование)** |
| --- | --- | --- |
| `0.0.0.0` | `00000000` | соответствие всем октетам |
| `0.0.0.63` | `00111111` | <ul><li>совпадение первых трех октетов</li><li>сопоставление двух левых битов последнего октета</li><li>игнорировать последние шесть битов адреса</li></ul> |
| `0.0.0.15` | `00001111` | <ul><li>совпадение первых трех октетов</li><li>совпадение четырех левых битов последнего октета</li><li>игнорировать последние четыре бита последнего октета</li></ul> |
| `0.0.0.248` | `11111100` | <ul><li>совпадение первых трех октетов</li><li>игнорировать шесть левых битов последнего октета</li><li>совпадение последних двух битов</li></ul> |
| `0.0.0.255` | `11111111` | <ul><li>совпадение первых трех октетов</li><li>игнорировать последний октет</li></ul> |

<!-- 4.2.2 -->
## Типы шаблонных масок

Использование шаблонных масок требует некоторой практики. Обратитесь к примерам, чтобы узнать, как шаблонная маска используется для фильтрации трафика для одного узла, одной подсети и адресов диапазона IPv4.

**Шаблонные маски для соответствия хосту**

В этом примере шаблонная маска используется для сопоставления конкретного IPv4-адреса узла. Предположим, ACL 10 требуется ACE, который разрешает только узел с адресом IPv4 192.168.1.1. Напомним, что «0» равно совпадению, а «1» равно игнорированию. Для соответствия конкретному адресу IPv4 узла требуется шаблонная маска, состоящая из всех нулей (т.е. 0.0.0.0).

В таблице в двоичном формате перечислены: адрес IPv4 узла, шаблонная маска и разрешенный адрес IPv4.

Шаблонная маска 0.0.0.0 предусматривает, что каждый бит должен точно совпадать. Поэтому при обработке ACE шаблонная маска разрешает только адрес 192.168.1.1. Полученный ACE в ACL 10 будет **access-list 10 permit 192.168.1.1 0.0.0.0**.

|  | **Десятичные** | **Двоичные** |
| --- | --- | --- |
| Адрес IPv4 | 192.168.1.1 | `11000000.10101000.00000001.00000001` |
| Шаблонная маска | 0.0.0.0 | `00000000.00000000.00000000.00000000` |
| **Разрешенный IPv4 адрес** | **192.168.1.1** | `11000000.10101000.00000001.00000001` |

**Расчет шаблонных масок для соответствия подсетям IPv4**

В этом примере ACL 10 требуется ACE, разрешающий все узлы в сети 192.168.1.0/24. Шаблонная маска 0.0.0.255 предусматривает, что первые три октета должны точно совпадать, а четвертый октет — нет.

В таблице в двоичном формате перечислены: адрес IPv4 узла, шаблонная маска и разрешенные адреса IPv4.

При обработке шаблонная маска 0.0.0.255 разрешает все узлы в сети 192.168.1.0/24. Полученный ACE в ACL 10 будет **access-list 10 permit 192.168.1.0 0.0.0.255**.

|  | **Десятичные**  | **Двоичные**  |
| --- | --- | --- |
| Адрес IPv4 | 192.168.1.1 | `11000000.10101000.00000001.00000001` |
| Шаблонная маска | 0.0.0.255 | `00000000.00000000.00000000.11111111` |
| **Разрешенный IPv4 адрес** | **192.168.1.0/24** | `11000000.10101000.00000001.00000000` |

**Шаблонная маска для соответствия диапазону адресов IPv4**

В этом примере ACL 10 требуется ACE, разрешающий все узлы в сетях 192.168.16.0/24, 192.168.17.0/24, ..., 192.168.31.0/24. Шаблонная  маска 0.0.15.255 корректно фильтрует этот диапазон адресов.

В таблице в двоичном формате представлены: адрес узла IPv4, шаблонная маска и разрешенные адреса IPv4.

Выделенные биты шаблонной маски определяют, какие биты IPv4-адреса должны совпадать. При обработке шаблонной маски 0.0.15.255 разрешает все узлы в сетях 192.168.16.0/24 до 192.168.31.0/24. Полученный ACE в ACL 10 будет **access-list 10 permit 192.168.16.0 0.0.15.255**.

|  | **Десятичные**  | **Двоичные**  |
| --- | --- | --- |
| Адрес IPv4 | 192.168.16.0 | `11000000.10101000.00010000.00000000` |
| Шаблонная маска | 0.0.15.255 | `00000000.00000000.00001111.11111111` |
| **Разрешенный IPv4 адрес** | **192.168.16.0/24<br>–<br>192.168.31.0/24** | `11000000.10101000.00010000.00000000`<br><br>`11000000.10101000.00011111.00000000` |

<!-- 4.2.3 -->
## Расчёт шаблонной маски

При вычислении шаблонных масок можно столкнуться с определенными сложностями. Простым способом является вычитание маски подсети из 255.255.255.255. Ниже приведены примеры, чтобы узнать, как вычислить шаблонную маску с помощью маски подсети.

**Пример 1**

Предположим, вы хотели, чтобы ACE в ACL 10 разрешил доступ всем пользователям в сети 192.168.3.0/24. Чтобы вычислить шаблонную маску, вычтите маску подсети (например, 255.255.255.0) из 255.255.255, как показано в таблице.

В результате получается шаблонная маска 0.0.0.255. Таким образом, ACE будет **access-list 10 permit 192.168.3.0 0.0.0.255**.

|  |  |
| --- | --- |
| Начальное значение | ` 255.255.255.255` |
| Вычесть маску подсети | `- 255.255.255. 0` |
| **Результирующая шаблонная маска** | ` 0. 0. 0.255` |

**Пример 2**

В этом примере предположим, что вы хотели, чтобы ACE в ACL 10 разрешил сетевой доступ для 14 пользователей в подсети 192.168.3.32/28. Вычтите подсеть (например, 255.255.255.240) из 255.255.255, как показано в таблице.

В результате получается шаблонная маска 0.0.0.15. Таким образом, ACE будет **access-list 10 permit 192.168.3.32 0.0.0.15**.

|  |  |
| --- | --- |
| Начальное значение | ` 255.255.255.255` |
| Вычесть маску подсети | `- 255.255.255.240` |
| **Результирующая шаблонная маска** | ` 0. 0. 0. 15` |

**Пример 3**

В этом примере предположим, что для разрешения только сетей 192.168.10.0 и 192.168.11.0 требуется ACE в ACL 10. Эти две сети можно суммировать как 192.168.10.0/23, которая представляет собой маску подсети 255.255.254.0. Опять же, маска подсети 255.255.254.0 вычитается из 255.255.255, как показано в таблице.

В результате получается шаблонная маска 0.0.1.255. Таким образом, ACE будет **access-list 10 permit 192.168.10.0 0.0.1.255**.

|  |  |
| --- | --- |
| Начальное значение | ` 255.255.255.255` |
| Вычесть маску подсети | `- 255.255.254. 0` |
| **Результирующая шаблонная маска** | ` 0. 0. 1.255` |

**Пример 4**

Рассмотрим пример, в котором вам нужен ACL-номер 10 для фильтрации сетей в диапазоне от 192.168.16.0/24 до 192.168.31.0/24. Этот диапазон сети можно суммировать как 192.168.16.0/20, который представляет собой маску подсети 255.255.240.0. Поэтому вычтите 255.255.240.0 из 255.255.255.255, как показано в таблице.

В результате получается шаблонная маска 0.0.15.255. Таким образом, ACE будет **access-list 10 permit 192.168.16.0 0.0.15.255**.

|  |  |
| --- | --- |
| Начальное значение | ` 255.255.255.255` |
| Вычесть маску подсети | `- 255.255.240. 0` |
| **Результирующая шаблонная маска** | ` 0. 0. 15.255` |

<!-- 4.2.4 -->
## Ключевые слова шаблонной маски

Работа с десятичными представлениями двоичной шаблонной маски может быть трудоемкой. Чтобы упростить эту задачу, Cisco IOS предоставляет два ключевых слова для определения наиболее распространенного использования шаблонной маски. Ключевые слова уменьшают количество нажатий клавиш ACL и облегчают чтение ACE.

Ключевые слова:

* **host** применяется для маски 0.0.0.0, она подразумевает соответствие всех битов IPv4-адреса, фильтруется единственный адрес хоста;
* **any** замещает маску 255.255.255.255, которая указывает игнорировать весь IPv4-адрес или принять любой адрес.

Например, в выходных данных команды настраиваются два списка ACL. ACL 10 ACE разрешает только узел 192.168.10.10, а ACL 11 ACE разрешает все узлы.

```
R1(config)# access-list 10 permit 192.168.10.10  0.0.0.0
R1(config)# access-list 11 permit  0.0.0.0 255.255.255.255
R1(config)#
```

В качестве альтернативы, ключевые слова **host** и **any** могли быть использованы для замены выделенного вывода.

Следующие команды выполняют ту же задачу, что и предыдущие.

```
R1(config)# access-list 10 permit  host  192.168.10.10
R1(config)# access-list 11 permit  any
R1(config)#
```

<!-- 4.2.5 -->
<!-- quiz -->

