<!-- 10.5.1 -->
## Введение в Syslog

Как и индикатор Check Engine на приборной панели автомобиля, компоненты в вашей сети могут сказать вам, если что-то не так. Протокол syslog был разработан для обеспечения того, чтобы вы могли получать и понимать эти сообщения. При возникновении определенных событий в сети сетевые устройства, используя доверенные механизмы, уведомляют администратора с помощью подробных системных сообщений. Эти сообщения могут быть некритическими или существенно важными. В распоряжении сетевых администраторов — широкий ассортимент вариантов хранения, интерпретации и отображения различных сообщений. Они также могут быть оповещены о тех сообщениях, которые могут оказать наибольшее влияние на сетевую инфраструктуру.

Самый распространенный способ получения системных сообщений — это использование протокола под названием syslog.

Термин syslog используется для описания стандарта. Он также используется для описания протокола, разработанного для этого стандарта. Протокол syslog был разработан для систем UNIX еще в 80-е гг. прошлого века, но был впервые документирован сообществом IETF под названием RFC 3164 только в 2001 г. Syslog использует порт UDP 514 для отправки сообщений с уведомлением о событиях по сетям IP на средства сбора сообщений о событиях, как показано на рисунке.

![](./assets/10.5.1.png)
<!-- /courses/ensa-dl/ae8eb392-34fd-11eb-ba19-f1886492e0e4/aeb5eaa6-34fd-11eb-ba19-f1886492e0e4/assets/c6b80aa0-1c46-11ea-af56-e368b99e9723.svg -->

<!--
Syslog использует порт UDP 514 для отправки сообщений с уведомлением о событиях по сетям IP на средства сбора сообщений о событиях, как показано на рисунке. На рисунке показан маршрутизатор с меткой R1 и коммутатор с меткой S1, отправляющий системные сообщения на сервер syslog.
-->

Syslog поддерживают многие сетевые устройства, включая маршрутизаторы, коммутаторы, серверы приложений, межсетевые экраны и др. Протокол syslog позволяет сетевым устройствам отправлять системные сообщения по сети на серверы syslog.

Существуют различные пакеты ПО сервера Syslog для Windows и UNIX. Многие из них бесплатны.

Сервис ведения системного журнала выполняет три основные функции:

* сбор информации в журнал для мониторинга и устранения неполадок;
* выбор типа информации, сбор которой будет осуществляться;
* определение получателей собранных сообщений syslog.

<!-- 10.5.2 -->
## Принцип работы Syslog

На сетевых устройствах Cisco протокол syslog начинает с отправки системных сообщений и вывода процесса **debug** в локальный процесс ведения журналов соответствующего устройства. Каким образом процесс ведения журналов управляет этими сообщениями и выводом, зависит от настроек устройства. Например, сообщения syslog могут отправляться по сети на внешний сервер syslog. Эти сообщения можно прочитать без необходимости доступа к самому устройству. Сообщения журнала и выходные данные, хранящиеся на внешнем сервере, могут включаться в различные отчеты для упрощения их прочтения.

Кроме того, сообщения syslog могут отправляться во внутренний буфер. Сообщения, отправленные во внутренний буфер, можно просматривать только через интерфейс командной строки устройства.

Наконец, сетевой администратор может указать, какие типы системных сообщений будут отправляться в различные места назначения. Например, можно настроить устройство, чтобы все системные сообщения отправлялись на внешний сервер syslog. Однако сообщения уровня debug будут пересылаться во внутренний буфер и будут доступны только администратору через интерфейс командной строки.

Как показано на рисунке, в число популярных назначений для сообщений syslog входят следующие:

* буфер ведения журналов (ОЗУ в маршрутизаторе или коммутаторе);
* порт консоли;
* линия терминала;
* Сервер Syslog.

![](./assets/10.5.2.png)
<!-- /courses/ensa-dl/ae8eb392-34fd-11eb-ba19-f1886492e0e4/aeb5eaa6-34fd-11eb-ba19-f1886492e0e4/assets/c6b87fd2-1c46-11ea-af56-e368b99e9723.svg -->

<!--
На рисунке показаны популярные места назначения для сообщений системного журнала. Коммутатор имеет стрелки, указывающие на буфер ведения журнала, компьютер с помеченной консольной линией, другой компьютер с помеченной терминальной линией и сервер системного журнала.
-->

Можно удаленно наблюдать за системными сообщениями путем просмотра журналов на сервере Syslog или путем доступа к устройству по протоколам Telnet, SSH или через порт консоли.

<!-- 10.5.3 -->
## Формат сообщений syslog

Устройства Cisco создают сообщения syslog при определенных сетевых событиях. Во всех сообщениях syslog указывается уровень важности (severity level) и объект (facility).

Чем меньше назначаемое число, тем более важным является оповещение syslog. В настройках уровня важности сообщений можно установить, куда отправлять сообщения каждого типа (например на консоль или в другие места назначения). Полный перечень уровней syslog представлен в таблице.

| **Название уровня серьезности** | **Уровень серьезности** | **Описание** |
| --- | --- | --- |
| Чрезвычайная ситуация | Уровень 0 | Систему нельзя использовать |
| Предупреждение | Уровень 1 | Требуется принять немедленные меры |
| Критический | Уровень 2 | Критическое состояние |
| Ошибка | Уровень 3 | Состояние ошибки |
| Предупреждение | Уровень 4 | Состояние предупреждения |
| Уведомление | Уровень 5 | Нормальное, но требующее внимания состояние |
| Информационный | Уровень 6 | Информационное сообщение |
| Отладка | Уровень 7 | Сообщение отладки |

Каждый уровень syslog имеет собственный смысл:

* **Предупреждение (Уровень 4) - Чрезвычайная ситуация (Уровень 0)**: Это сообщения о сбоях программного или аппаратного обеспечения. Эти типы сообщений свидетельствуют о том, что затронута работа устройства. Назначаемый уровень syslog зависит от серьезности проблемы.
* **Уведомление (Уровень 5)**: Этот уровень уведомлений об обычных, но важных событиях. На уровне уведомления, например, отображаются сообщения об изменении состояния интерфейса на активное или неактивное или о перезапуске системы.
* **Информационный (Уровень 6)**: Это обычные информационные сообщения, которые не влияют на работу устройства. Например, при загрузке устройства Cisco может появиться следующее информационное сообщение: %LICENSE-6-EULA\_ACCEPT\_ALL: The Right to Use End User License Agreement is accepted.
* **Отладка (Уровень 7)**: Сообщения этого уровня содержат выходные данные, полученные в результате выполнения различных команд **debug**.

<!-- 10.5.4 -->
## Объекты Syslog

Помимо указания уровня важности в сообщениях syslog также содержатся сведения об объекте. Объекты syslog (syslog facilities) — это идентификаторы сервисов, которые определяют и классифицируют данные о состоянии системы для отчетов об ошибках и событиях. Доступные варианты объектов ведения журнала зависят от конкретного сетевого устройства. Например, коммутаторы Cisco серии 2960, в которых используется Cisco IOS версии 15.0(2), и маршрутизаторы Cisco 1941, в которых используется Cisco IOS версии 15.2(4), поддерживают 24 варианта объектов, которые группируются в 12 типов объектов.

Ниже приведены некоторые из общепринятых объектов сообщений syslog, которые регистрируются на маршрутизаторах Cisco IOS:

* IP
* Протокол OSPF
* Операционная система SYS
* Протокол IPSec
* IP интерфейса (IF)

По умолчанию формат сообщений syslog в ПО Cisco IOS выглядит следующим образом:

```
%facility-severity-MNEMONIC: description 
```

Пример выходных данных об изменении состояния канала EtherChannel коммутатора Cisco на активное будет выглядеть следующим образом:

```
%LINK-3-UPDOWN: Interface Port-channel1, changed state to up
```

В этом примере объектом является LINK, назначен уровень серьезности 3, в качестве КРАТКОГО КОДА выступает UPDOWN.

Наиболее распространенными сообщениями являются сообщения об изменении состояния каналов на активное и неактивное, а также сообщения, создаваемые устройством при выходе из режима настройки. Если настроено журналирование в списках контроля доступа, устройство создает сообщения syslog, если пакеты соответствуют заданным условиям.

<!-- 10.5.5 -->
## Настройка временной метки системного журнала

По умолчанию в сообщениях журнала нет метки времени. В примере, интерфейс GigabitEthernet 0/0/0 маршрутизатора R1 отключен. Сообщение, зарегистрированное на консоли, не показывает, когда состояние интерфейса было изменено. Сообщения журнала должны иметь метку времени. Потому что, когда они отправляются следующему адресату, например на сервер системного журнала, появляется запись о создании сообщения.

```
R1# configure terminal
R1(config)# interface g0/0/0
R1(config-if)# shutdown
%LINK-5-CHANGED: Interface GigabitEthernet0/0/0, changed state to administratively down
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0/0, changed state to down
R1(config-if)# exit
R1(config)# service timestamps log datetime
R1(config)# interface g0/0/0
R1(config-if)# no shutdown
*Mar  1 11:52:42: %LINK-3-UPDOWN: Interface GigabitEthernet0/0/0, changed state to down
*Mar  1 11:52:45: %LINK-3-UPDOWN: Interface GigabitEthernet0/0/0, changed state to up
*Mar  1 11:52:46: %LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0/0, 
changed state to up
R1(config-if)#
```

Команда **service timestamps log datetime** позволяет принудительно отображать дату и время для зарегистрированных событий. Как показано на рисунке, теперь при повторном включении интерфейса GigabitEthernet 0/0/0 на маршрутизаторе сообщения журнала содержат дату и время.

**Примечание**: При использовании ключевого слова **datetime** часы на сетевом устройстве необходимо настроить либо вручную, либо с помощью NTP, как упоминалось ранее.

<!-- 10.5.6 -->
<!-- quiz -->

